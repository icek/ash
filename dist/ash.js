!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ash=e():t.ash=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=34)}([function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this._keys=[],this._values=[]}return t.prototype.set=function(t,e){var n=this._keys.indexOf(t);if(n<0){var i=this._keys.length;this._keys[i]=t,this._values[i]=e}else this._values[n]=e;return e},t.prototype.get=function(t){var e=this._keys.indexOf(t);return e<0?null:this._values[e]},t.prototype.has=function(t){return!(this._keys.indexOf(t)<0)},t.prototype.remove=function(t){var e=this._keys.indexOf(t);return e<0?null:(this._keys.splice(e,1),this._values.splice(e,1)[0])},t.prototype.keys=function(){return this._keys},t.prototype.values=function(){return this._values},t}();e.ClassMap=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),o=n(29),r=function(){function t(){this._numListeners=0,this.nodes=new i.ClassMap,this.listenerNodePool=new o.ListenerNodePool}return t.prototype.startDispatch=function(){this.dispatching=!0},t.prototype.endDispatch=function(){this.dispatching=!1,this.toAddHead&&(this.head?(this.tail.next=this.toAddHead,this.toAddHead.previous=this.tail,this.tail=this.toAddTail):(this.head=this.toAddHead,this.tail=this.toAddTail),this.toAddHead=null,this.toAddTail=null),this.listenerNodePool.releaseCache()},Object.defineProperty(t.prototype,"numListeners",{get:function(){return this._numListeners},enumerable:!0,configurable:!0}),t.prototype.add=function(t){if(!this.nodes.has(t)){var e=this.listenerNodePool.get();e.listener=t,this.nodes.set(t,e),this.addNode(e)}},t.prototype.addOnce=function(t){if(!this.nodes.has(t)){var e=this.listenerNodePool.get();e.listener=t,e.once=!0,this.nodes.set(t,e),this.addNode(e)}},t.prototype.addNode=function(t){this.dispatching?this.toAddHead?(this.toAddTail.next=t,t.previous=this.toAddTail,this.toAddTail=t):this.toAddHead=this.toAddTail=t:this.head?(this.tail.next=t,t.previous=this.tail,this.tail=t):this.head=this.tail=t,this._numListeners++},t.prototype.remove=function(t){var e=this.nodes.get(t);e&&(this.head===e&&(this.head=this.head.next),this.tail===e&&(this.tail=this.tail.previous),this.toAddHead===e&&(this.toAddHead=this.toAddHead.next),this.toAddTail===e&&(this.toAddTail=this.toAddTail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous),this.nodes.remove(t),this.dispatching?this.listenerNodePool.cache(e):this.listenerNodePool.dispose(e),this._numListeners--)},t.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=this.head.next,this.nodes.remove(t.listener),this.listenerNodePool.dispose(t)}this.tail=null,this.toAddHead=null,this.toAddTail=null,this._numListeners=0},t}();e.SignalBase=r},function(t,e,n){var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.dispatch=function(t){this.startDispatch();var e;for(e=this.head;e;e=e.next)e.listener.call(e,t),e.once&&this.remove(e.listener);this.endDispatch()},e}(o.SignalBase);e.Signal1=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),o=n(4),r=n(5),s=function(){function t(t,e){var n=this;this.releaseNodePoolCache=function(){n.engine.updateComplete.remove(n.releaseNodePoolCache),n.nodePool.releaseCache()},this.nodeClass=t,this.engine=e,this.init()}return t.prototype.init=function(){this.nodes=new o.NodeList,this.entities=new i.ClassMap,this.components=new i.ClassMap,this.nodePool=new r.NodePool(this.nodeClass,this.components);var t=this.nodePool.get();this.nodePool.dispose(t);var e=t.constructor.__ash_types__;for(var n in e)e.hasOwnProperty(n)&&this.components.set(e[n],n)},Object.defineProperty(t.prototype,"nodeList",{get:function(){return this.nodes},enumerable:!0,configurable:!0}),t.prototype.newEntity=function(t){this.addIfMatch(t)},t.prototype.componentAddedToEntity=function(t,e){this.addIfMatch(t)},t.prototype.componentRemovedFromEntity=function(t,e){this.components.has(e)&&this.removeIfMatch(t)},t.prototype.removeEntity=function(t){this.removeIfMatch(t)},t.prototype.addIfMatch=function(t){if(!this.entities.has(t)){for(var e=0,n=this.components.keys();e<n.length;e++){var i=n[e];if(!t.has(i))return}var o=this.nodePool.get();o.entity=t;for(var r=0,s=this.components.keys();r<s.length;r++){var i=s[r];o[this.components.get(i)]=t.get(i)}this.entities.set(t,o),this.nodes.add(o)}},t.prototype.removeIfMatch=function(t){if(this.entities.has(t)){var e=this.entities.get(t);this.entities.remove(t),this.nodes.remove(e),this.engine.updating?(this.nodePool.cache(e),this.engine.updateComplete.add(this.releaseNodePoolCache)):this.nodePool.dispose(e)}},t.prototype.cleanUp=function(){for(var t=this.nodes.head;t;t=t.next)this.entities.remove(t.entity);this.nodes.removeAll()},t}();e.ComponentMatchingFamily=s},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),o=function(){function t(){this.nodeAdded=new i.Signal1,this.nodeRemoved=new i.Signal1}return t.prototype.add=function(t){this.head?(this.tail.next=t,t.previous=this.tail,t.next=null,this.tail=t):(this.head=this.tail=t,t.next=t.previous=null),this.nodeAdded.dispatch(t)},t.prototype.remove=function(t){this.head===t&&(this.head=this.head.next),this.tail===t&&(this.tail=this.tail.previous),t.previous&&(t.previous.next=t.next),t.next&&(t.next.previous=t.previous),this.nodeRemoved.dispatch(t)},t.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=t.next,t.previous=null,t.next=null,this.nodeRemoved.dispatch(t)}this.tail=null},Object.defineProperty(t.prototype,"empty",{get:function(){return null==this.head},enumerable:!0,configurable:!0}),t.prototype.swap=function(t,e){if(t.previous===e)t.previous=e.previous,e.previous=t,e.next=t.next,t.next=e;else if(e.previous===t)e.previous=t.previous,t.previous=e,t.next=e.next,e.next=t;else{var n=t.previous;t.previous=e.previous,e.previous=n,n=t.next,t.next=e.next,e.next=n}this.head===t?this.head=e:this.head===e&&(this.head=t),this.tail===t?this.tail=e:this.tail===e&&(this.tail=t),t.previous&&(t.previous.next=t),e.previous&&(e.previous.next=e),t.next&&(t.next.previous=t),e.next&&(e.next.previous=e)},t.prototype.insertionSort=function(t){if(this.head!==this.tail)for(var e=this.head.next,n=e;n;n=e){var i=void 0;for(e=n.next,i=n.previous;i;i=i.previous)if(t(n,i)>=0){n!==i.next&&(this.tail===n&&(this.tail=n.previous),n.previous.next=n.next,n.next&&(n.next.previous=n.previous),n.next=i.next,n.previous=i,n.next.previous=n,i.next=n);break}i||(this.tail===n&&(this.tail=n.previous),n.previous.next=n.next,n.next&&(n.next.previous=n.previous),n.next=this.head,this.head.previous=n,n.previous=null,this.head=n)}},t.prototype.mergeSort=function(t){if(this.head!==this.tail){for(var e,n=[],i=this.head;i;){for(e=i;e.next&&t(e,e.next)<=0;)e=e.next;var o=e.next;i.previous=e.next=null,n[n.length]=i,i=o}for(;n.length>1;)n.push(this.merge(n.shift(),n.shift(),t));for(this.tail=this.head=n[0];this.tail.next;)this.tail=this.tail.next}},t.prototype.merge=function(t,e,n){var i,o;for(n(t,e)<=0?(o=i=t,t=t.next):(o=i=e,e=e.next);t&&e;)n(t,e)<=0?(i.next=t,t.previous=i,i=t,t=t.next):(i.next=e,e.previous=i,i=e,e=e.next);return t?(i.next=t,t.previous=i):(i.next=e,e.previous=i),o},t}();e.NodeList=o},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.nodeClass=t,this.components=e}return t.prototype.get=function(){if(this.tail){var t=this.tail;return this.tail=this.tail.previous,t.previous=null,t}return new this.nodeClass},t.prototype.dispose=function(t){for(var e=0,n=this.components.values();e<n.length;e++){t[n[e]]=null}t.entity=null,t.next=null,t.previous=this.tail,this.tail=t},t.prototype.cache=function(t){t.previous=this.cacheTail,this.cacheTail=t},t.prototype.releaseCache=function(){for(;this.cacheTail;){var t=this.cacheTail;this.cacheTail=t.previous,this.dispose(t)}},t}();e.NodePool=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.priority=0}return t}();e.System=n},function(t,e,n){var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.dispatch=function(){this.startDispatch();var t;for(t=this.head;t;t=t.next)t.listener.call(t),t.once&&this.remove(t.listener);this.endDispatch()},e}(o.SignalBase);e.Signal0=r},function(t,e,n){var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.dispatch=function(t,e){this.startDispatch();var n;for(n=this.head;n;n=n.next)n.listener.call(n,t,e),n.once&&this.remove(n.listener);this.endDispatch()},e}(o.SignalBase);e.Signal2=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.ClassMap=i.ClassMap;var o=n(7);e.Signal0=o.Signal0;var r=n(2);e.Signal1=r.Signal1;var s=n(8);e.Signal2=s.Signal2;var a=n(30);e.Signal3=a.Signal3;var u=n(3);e.ComponentMatchingFamily=u.ComponentMatchingFamily;var h=n(10);e.Engine=h.Engine;var p=n(11);e.Entity=p.Entity;var d=n(13);e.Node=d.Node,e.keep=d.keep;var c=n(4);e.NodeList=c.NodeList;var l=n(5);e.NodePool=l.NodePool;var f=n(6);e.System=f.System;var v=n(23);e.EntityStateMachine=v.EntityStateMachine;var y=n(21);e.EngineStateMachine=y.EngineStateMachine;var m=n(31);e.RAFTickProvider=m.RAFTickProvider;var g=n(32);e.ComponentPool=g.ComponentPool;var _=n(33);e.ListIteratingSystem=_.ListIteratingSystem},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),o=n(3),r=n(12),s=n(14),a=n(7),u=function(){function t(){var t=this;this.familyClass=o.ComponentMatchingFamily,this.entityNameChanged=function(e,n){t.entityNames[n]===e&&(t.entityNames[n]=null,t.entityNames[e.name]=e)},this.componentAdded=function(e,n){for(var i=0,o=t.families.values();i<o.length;i++){o[i].componentAddedToEntity(e,n)}},this.componentRemoved=function(e,n){for(var i=0,o=t.families.values();i<o.length;i++){o[i].componentRemovedFromEntity(e,n)}},this.entityList=new r.EntityList,this.entityNames=[],this.systemList=new s.SystemList,this.families=new i.ClassMap,this.updateComplete=new a.Signal0}return t.prototype.addEntity=function(t){if(this.entityNames[t.name])throw new Error("The entity name "+t.name+" is already in use by another entity.");this.entityList.add(t),this.entityNames[t.name]=t,t.componentAdded.add(this.componentAdded),t.componentRemoved.add(this.componentRemoved),t.nameChanged.add(this.entityNameChanged);for(var e=0,n=this.families.values();e<n.length;e++){n[e].newEntity(t)}},t.prototype.removeEntity=function(t){t.componentAdded.remove(this.componentAdded),t.componentRemoved.remove(this.componentRemoved),t.nameChanged.remove(this.entityNameChanged);for(var e=0,n=this.families.values();e<n.length;e++){n[e].removeEntity(t)}this.entityNames[t.name]=null,this.entityList.remove(t)},t.prototype.getEntityByName=function(t){return this.entityNames[t]},t.prototype.removeAllEntities=function(){for(;this.entityList.head;)this.removeEntity(this.entityList.head)},Object.defineProperty(t.prototype,"entities",{get:function(){for(var t=[],e=this.entityList.head;e;e=e.next)t[t.length]=e;return t},enumerable:!0,configurable:!0}),t.prototype.getNodeList=function(t){if(this.families.has(t))return this.families.get(t).nodeList;var e=new this.familyClass(t,this);this.families.set(t,e);for(var n=this.entityList.head;n;n=n.next)e.newEntity(n);return e.nodeList},t.prototype.releaseNodeList=function(t){this.families.has(t)&&this.families.get(t).cleanUp(),this.families.remove(t)},t.prototype.addSystem=function(t,e){t.priority=e,t.addToEngine(this),this.systemList.add(t)},t.prototype.getSystem=function(t){return this.systemList.get(t)},Object.defineProperty(t.prototype,"systems",{get:function(){for(var t=[],e=this.systemList.head;e;e=e.next)t[t.length]=e;return t},enumerable:!0,configurable:!0}),t.prototype.removeSystem=function(t){this.systemList.remove(t),t.removeFromEngine(this)},t.prototype.removeAllSystems=function(){for(;this.systemList.head;){var t=this.systemList.head;this.systemList.head=this.systemList.head.next,t.previous=null,t.next=null,t.removeFromEngine(this)}this.systemList.tail=null},t.prototype.update=function(t){this.updating=!0;for(var e=this.systemList.head;e;e=e.next)e.update(t);this.updating=!1,this.updateComplete.dispatch()},t}();e.Engine=u},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(8),o=n(0),r=function(){function t(e){void 0===e&&(e=""),this.componentAdded=new i.Signal2,this.componentRemoved=new i.Signal2,this.nameChanged=new i.Signal2,this.components=new o.ClassMap,this._name=e?e:"_entity"+ ++t.nameCount}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){if(this._name!==t){var e=this._name;this._name=t,this.nameChanged.dispatch(this,e)}},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){return void 0===e&&(e=null),e||(e=t.constructor.prototype.constructor),this.components.has(e)&&this.remove(e),this.components.set(e,t),this.componentAdded.dispatch(this,e),this},t.prototype.remove=function(t){var e=this.components.get(t);return e?(this.components.remove(t),this.componentRemoved.dispatch(this,t),e):null},t.prototype.get=function(t){return this.components.get(t)},t.prototype.getAll=function(){for(var t=[],e=0,n=this.components.values();e<n.length;e++){var i=n[e];t[t.length]=i}return t},t.prototype.has=function(t){return this.components.has(t)},t}();r.nameCount=0,e.Entity=r},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.add=function(t){this.head?(this.tail.next=t,t.previous=this.tail,t.next=null,this.tail=t):(this.head=this.tail=t,t.next=t.previous=null)},t.prototype.remove=function(t){this.head===t&&(this.head=this.head.next),this.tail===t&&(this.tail=this.tail.previous),t.previous&&(t.previous.next=t.next),t.next&&(t.next.previous=t.previous)},t.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=this.head.next,t.previous=null,t.next=null}this.tail=null},t}();e.EntityList=n},function(t,e){function n(t){return function(e,n,i){var o,r=e.constructor;return r.hasOwnProperty("__ash_types__")?o=r.__ash_types__:(o={},Object.defineProperty(r,"__ash_types__",{enumerable:!0,value:o})),o[n]=t,i}}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.entity=null,this.previous=null,this.next=null}return t}();e.Node=i,e.keep=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.add=function(t){if(this.head){var e=void 0;for(e=this.tail;e&&!(e.priority<=t.priority);e=e.previous);e===this.tail?(this.tail.next=t,t.previous=this.tail,t.next=null,this.tail=t):e?(t.next=e.next,t.previous=e,e.next.previous=t,e.next=t):(t.next=this.head,t.previous=null,this.head.previous=t,this.head=t)}else this.head=this.tail=t,t.next=t.previous=null},t.prototype.remove=function(t){this.head===t&&(this.head=this.head.next),this.tail===t&&(this.tail=this.tail.previous),t.previous&&(t.previous.next=t.next),t.next&&(t.next.previous=t.previous)},t.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=this.head.next,t.previous=null,t.next=null}this.tail=null},t.prototype.get=function(t){for(var e=this.head;e;e=e.next)if(e instanceof t)return e;return null},t}();e.SystemList=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.instance=t}return t.prototype.getComponent=function(){return this.instance},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.instance},enumerable:!0,configurable:!0}),t}();e.ComponentInstanceProvider=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.componentType=t}return t.prototype.getComponent=function(){return this.instance||(this.instance=new this.componentType),this.instance},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.getComponent()},enumerable:!0,configurable:!0}),t}();e.ComponentSingletonProvider=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.componentType=t}return t.prototype.getComponent=function(){return new this.componentType},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.componentType},enumerable:!0,configurable:!0}),t}();e.ComponentTypeProvider=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this._closure=t}return t.prototype.getComponent=function(){return this._closure()},Object.defineProperty(t.prototype,"identifier",{get:function(){return this._closure},enumerable:!0,configurable:!0}),t}();e.DynamicComponentProvider=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.systemPriority=0,this.method=t}return t.prototype.getSystem=function(){return this.method()},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.method},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this.systemPriority},set:function(t){this.systemPriority=t},enumerable:!0,configurable:!0}),t}();e.DynamicSystemProvider=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(19),o=n(25),r=n(26),s=n(27),a=function(){function t(){this.providers=[]}return t.prototype.addInstance=function(t){return this.addProvider(new r.SystemInstanceProvider(t))},t.prototype.addSingleton=function(t){return this.addProvider(new s.SystemSingletonProvider(t))},t.prototype.addMethod=function(t){return this.addProvider(new i.DynamicSystemProvider(t))},t.prototype.addProvider=function(t){var e=new o.StateSystemMapping(this,t);return this.providers[this.providers.length]=t,e},t}();e.EngineState=a},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(20),o=function(){function t(t){this.engine=t,this.states=[]}return t.prototype.addState=function(t,e){return this.states[t]=e,this},t.prototype.createState=function(t){var e=new i.EngineState;return this.states[t]=e,e},t.prototype.changeState=function(t){var e=this.states[t];if(!e)throw new Error("Engine state "+t+" doesn't exist");if(e===this.currentState)return void(e=null);for(var n,i=[],o=0,r=e.providers;o<r.length;o++){var s=r[o];n=s.identifier,i[n]=s}if(this.currentState)for(var a=0,u=this.currentState.providers;a<u.length;a++){var s=u[a];n=s.identifier;var h=i[n];h?delete i[n]:this.engine.removeSystem(s.getSystem())}for(var p=0,d=i;p<d.length;p++){var s=d[p];this.engine.addSystem(s.getSystem(),s.priority)}this.currentState=e},t}();e.EngineStateMachine=o},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(24),o=n(0),r=function(){function t(){this.providers=new o.ClassMap}return t.prototype.add=function(t){return new i.StateComponentMapping(this,t)},t.prototype.get=function(t){return this.providers.get(t)},t.prototype.has=function(t){return this.providers.has(t)},t}();e.EntityState=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(22),o=n(0),r=function(){function t(t){this.entity=t,this.states=[]}return t.prototype.addState=function(t,e){return this.states[t]=e,this},t.prototype.createState=function(t){var e=new i.EntityState;return this.states[t]=e,e},t.prototype.changeState=function(t){var e=this.states[t];if(!e)throw new Error("Entity state "+t+" doesn't exist");if(e===this.currentState)return void(e=null);var n;if(this.currentState){n=new o.ClassMap;for(var i=0,r=e.providers.keys();i<r.length;i++){var s=r[i];n.set(s,e.providers.get(s))}for(var a=0,u=this.currentState.providers.keys();a<u.length;a++){var s=u[a],h=n.get(s);h&&h.identifier===this.currentState.providers.get(s).identifier?n.remove(s):this.entity.remove(s)}}else n=e.providers;for(var p=0,d=n.keys();p<d.length;p++){var s=d[p];this.entity.add(n.get(s).getComponent(),s)}this.currentState=e},t}();e.EntityStateMachine=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(15),o=n(16),r=n(17),s=n(18),a=function(){function t(t,e){this.creatingState=t,this.componentType=e,this.withType(e)}return t.prototype.withInstance=function(t){return this.setProvider(new i.ComponentInstanceProvider(t)),this},t.prototype.withType=function(t){return this.setProvider(new r.ComponentTypeProvider(t)),this},t.prototype.withSingleton=function(t){return void 0===t&&(t=null),t||(t=this.componentType),this.setProvider(new o.ComponentSingletonProvider(t)),this},t.prototype.withMethod=function(t){return this.setProvider(new s.DynamicComponentProvider(t)),this},t.prototype.withProvider=function(t){return this.setProvider(t),this},t.prototype.add=function(t){return this.creatingState.add(t)},t.prototype.setProvider=function(t){this.provider=t,this.creatingState.providers.set(this.componentType,t)},t}();e.StateComponentMapping=a},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.creatingState=t,this.provider=e}return t.prototype.withPriority=function(t){return this.provider.priority=t,this},t.prototype.addInstance=function(t){return this.creatingState.addInstance(t)},t.prototype.addSingleton=function(t){return this.creatingState.addSingleton(t)},t.prototype.addMethod=function(t){return this.creatingState.addMethod(t)},t.prototype.addProvider=function(t){return this.creatingState.addProvider(t)},t}();e.StateSystemMapping=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.systemPriority=0,this.instance=t}return t.prototype.getSystem=function(){return this.instance},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this.systemPriority},set:function(t){this.systemPriority=t},enumerable:!0,configurable:!0}),t}();e.SystemInstanceProvider=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.systemPriority=0,this.componentType=t}return t.prototype.getSystem=function(){return this.instance||(this.instance=new this.componentType),this.instance},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.getSystem()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this.systemPriority},set:function(t){this.systemPriority=t},enumerable:!0,configurable:!0}),t}();e.SystemSingletonProvider=n},function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t}();e.ListenerNode=n},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(28),o=function(){function t(){}return t.prototype.get=function(){if(this.tail){var t=this.tail;return this.tail=this.tail.previous,t.previous=null,t}return new i.ListenerNode},t.prototype.dispose=function(t){t.listener=null,t.once=!1,t.next=null,t.previous=this.tail,this.tail=t},t.prototype.cache=function(t){t.listener=null,t.previous=this.cacheTail,this.cacheTail=t},t.prototype.releaseCache=function(){for(;this.cacheTail;){var t=this.cacheTail;this.cacheTail=t.previous,t.next=null,t.previous=this.tail,this.tail=t}},t}();e.ListenerNodePool=o},function(t,e,n){var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.dispatch=function(t,e,n){this.startDispatch();var i;for(i=this.head;i;i=i.next)i.listener.call(i,t,e,n),i.once&&this.remove(i.listener);this.endDispatch()},e}(o.SignalBase);e.Signal3=r},function(t,e,n){var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),r=function(t){function e(){var e=t.call(this)||this;return e.update=function(){e.rafId=requestAnimationFrame(e.update);var t=Date.now();e.dispatch((t-e.previousTime)/1e3),e.previousTime=t},e}return i(e,t),e.prototype.start=function(){this.previousTime=Date.now(),this.playing=!0,this.rafId=requestAnimationFrame(this.update)},e.prototype.stop=function(){cancelAnimationFrame(this.rafId)},e}(o.Signal1);e.RAFTickProvider=r},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),o=function(){function t(){}return t.getPool=function(e){if(t.pools.has(e))return t.pools.get(e);var n=[];return t.pools.set(e,n),n},t.get=function(e){var n=t.getPool(e);return n.length>0?n.pop():new e},t.dispose=function(e){if(e){var n=e.constructor.prototype.constructor,i=t.getPool(n);i[i.length]=e}},t.empty=function(){t.pools=new i.ClassMap},t}();o.pools=new i.ClassMap,e.ComponentPool=o},function(t,e,n){var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),r=function(t){function e(e){var n=t.call(this)||this;return n.nodeClass=e,n}return i(e,t),e.prototype.addToEngine=function(t){if(this.nodeList=t.getNodeList(this.nodeClass),this.nodeAdded){for(var e=this.nodeList.head;e;e=e.next)this.nodeAdded(e);this.nodeList.nodeAdded.add(this.nodeAdded)}this.nodeRemoved&&this.nodeList.nodeRemoved.add(this.nodeRemoved)},e.prototype.removeFromEngine=function(t){this.nodeAdded&&this.nodeList.nodeAdded.remove(this.nodeAdded),this.nodeRemoved&&this.nodeList.nodeRemoved.remove(this.nodeRemoved),this.nodeList=null},e.prototype.update=function(t){for(var e=this.nodeList.head;e;e=e.next)this.updateNode(e,t)},e}(o.System);e.ListIteratingSystem=r},function(t,e,n){t.exports=n(9)}])});